<head>
<title>Alzabo: The Perl Data Modeling Tool</title>
</head>

<body>

<table width="100%" cellspacing="0">

 <tr>
  <td colspan="5" align="center"><& .title, $s, $t, $user, $password &></td>
 </tr>

% if ($s) {
<& schema_menubar, $s, $user, $password &>
% }
</table>

<% $m->call_next(%args) %>

</body>
</html>

<%args>
$schema => undef
$table => undef
$user => undef
$password => undef
$host => undef
</%args>

<%init>

my $s;
my %args;
my ($comp, @args);
if ($schema)
{
    eval{ $s = Alzabo::Runtime::Schema->load_from_file( name => $schema ); };
    $m->comp( &Alzabo::Config::mason_url_path . '/common/exception', $@ ) if $@;
    $args{s} = $s;

    my %c;
    $c{user} = $user if defined $user;
    $c{password} = $password if defined $password;
    $c{host} = $host if defined $host;
    $s->connect(%c);
}

my $t;
if ($table)
{
    eval{ $t = $s->table($table); };
    $m->comp( &Alzabo::Config::mason_url_path . '/common/exception', $@ ) if $@;
    $args{t} = $t;
}

</%init>

<%def .title>
<%init>
use Alzabo::Config;

my ( $s, $t, $user, $password ) = @_;

my @t;
if (defined $s)
{
    push @t, $m->scomp( Alzabo::Config::mason_url_path() . '/common/href',
			text => $s->name,
			path => 'browse_schema' . Alzabo::Config::mason_extension(),
			query => { schema => $s->name,
				   user => $user,
				   password => $password,
				 } );

    push @t, $m->scomp( Alzabo::Config::mason_url_path() . '/common/href',
			text => $t->name,
			path => 'browse_table' . Alzabo::Config::mason_extension(),
			query => { schema => $s->name,
				   table => $t->name,
				   user => $user,
				   password => $password,
				 } ) if defined $t;
}
</%init>
<div align="center">
<a href="<% &Alzabo::Config::mason_url_path %>/browser"><!--<img src="/alzabo/images/alzabo-logo.jpg" alt="return to index" border="0" width="75" height="50" hspacing="0" vspacing="0">-->Top level</a>
<hr width="25%" />
% if (@t) {
  <h2><% join ' : ', @t %></h2>
% }
</div>
</%def>
<%flags>
inherit => undef
</%flags>
