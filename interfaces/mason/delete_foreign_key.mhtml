<%args>
$schema
$table_from
$table_to
$column_from
$column_to
</%args>

<%init>
use Alzabo::Config;

my ($s, $t);
eval
{
    $s = Alzabo::Create::Schema->load_from_file( name => $schema );

    $t = $s->table($table_from);
    foreach my $fk ( $t->foreign_keys( table => $s->table($table_to),
				       column => $t->column($column_from) ) )
    {
	$t->delete_foreign_key($fk)
	    if $column_to eq $fk->column_to->name;
    }

    $s->save_to_file;
};

$m->comp( &Alzabo::Config::mason_url_path . '/common/exception', $@ ) if $@;

$m->comp( &Alzabo::Config::mason_url_path . '/common/redirect', url => 'view_table' . Alzabo::Config::mason_extension() . '?schema=' . $s->name . '&table=' . $t->name );
</%init>

<%flags>
inherit => undef
</%flags>
