<%args>
$schema
$table_from
$table_to
@columns_from
@columns_to
$min_max_from_1
$min_max_from_2
$min_max_to_1
$min_max_to_2
</%args>

<%init>
use Alzabo::Config;

if ($ARGS{more})
{
    delete $ARGS{more};
    $m->comp( '../common/redirect',
	      url =>
	      $m->comp( '../common/make_url',
			path => 'add_relation' . Alzabo::Config::mason_extension(),
			query => \%ARGS ) );
}

my $s;
eval
{
    $s = Alzabo::Create::Schema->load_from_file( name => $schema );

    my $t_from = $s->table($table_from);
    my $t_to = $s->table($table_to);
    my @c_from = $t_from->columns(@columns_from);
    my @c_to = $t_to->columns(@columns_to);

    $s->add_relation( table_from => $t_from,
		      table_to   => $t_to,
		      columns_from => \@c_from,
		      columns_to   => \@c_to,
		      min_max_from => [$min_max_from_1, $min_max_from_2],
		      min_max_to   => [$min_max_to_1, $min_max_to_2],
		    );

    $s->save_to_file;
};

$m->comp( '../common/exception', $@ ) if $@;

$m->comp( '../common/redirect', url => 'view_table' . Alzabo::Config::mason_extension() . '?schema=' . $s->name . '&table=' . $table_from );

</%init>

<%flags>
inherit => 'syshandler'
</%flags>
